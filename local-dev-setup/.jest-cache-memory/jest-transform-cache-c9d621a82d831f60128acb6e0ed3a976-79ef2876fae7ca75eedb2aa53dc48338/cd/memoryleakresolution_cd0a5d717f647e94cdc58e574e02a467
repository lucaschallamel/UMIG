b7ed44c1ee254dfa0c628b3ab4f36a36
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.MemoryLeakResolver = void 0;
exports.enhancedAfterEach = enhancedAfterEach;
exports.memoryLeakResolver = void 0;
exports.memoryOptimizedBeforeEach = memoryOptimizedBeforeEach;
class MemoryLeakResolver {
  constructor() {
    this.activeTimers = new Set();
    this.activeIntervals = new Set();
    this.activeEventListeners = new Map();
    this.activeDOMObservers = new Set();
    this.activeFetchRequests = new Set();
    this.memorySnapshots = [];
  }
  cleanupAccessibilityTester(testerInstance) {
    if (!testerInstance) return;
    try {
      if (testerInstance.violations) {
        testerInstance.violations.length = 0;
        testerInstance.violations = null;
      }
      if (testerInstance.document) {
        testerInstance.document = null;
      }
      if (testerInstance._cachedElements) {
        testerInstance._cachedElements.clear();
        testerInstance._cachedElements = null;
      }
      Object.keys(testerInstance).forEach(key => {
        testerInstance[key] = null;
      });
    } catch (error) {
      console.warn('Non-critical cleanup warning for AccessibilityTester:', error.message);
    }
  }
  cleanupDOMEnvironment(container, document) {
    if (!container || !document) return;
    try {
      const allElements = container.querySelectorAll('*');
      allElements.forEach(element => {
        const newElement = element.cloneNode(true);
        if (element.parentNode) {
          element.parentNode.replaceChild(newElement, element);
        }
      });
      container.innerHTML = '';
      if (container.dataset) {
        Object.keys(container.dataset).forEach(key => {
          delete container.dataset[key];
        });
      }
      if (typeof window !== 'undefined') {
        ['teamsManager', 'accessibilityTester', 'teamBuilder'].forEach(prop => {
          if (window[prop]) {
            window[prop] = null;
            delete window[prop];
          }
        });
      }
    } catch (error) {
      console.warn('Non-critical DOM cleanup warning:', error.message);
    }
  }
  cleanupTeamsManager(managerInstance) {
    if (!managerInstance) return;
    try {
      if (typeof managerInstance.destroy === 'function') {
        managerInstance.destroy();
      }
      if (managerInstance.cache) {
        if (managerInstance.cache.clear) {
          managerInstance.cache.clear();
        } else {
          managerInstance.cache = null;
        }
      }
      if (managerInstance.networkMetrics) {
        Object.keys(managerInstance.networkMetrics).forEach(key => {
          managerInstance.networkMetrics[key] = 0;
        });
        managerInstance.networkMetrics = null;
      }
      if (managerInstance.retryConfig) {
        managerInstance.retryConfig = null;
      }
      if (managerInstance.errorRecoveryCallbacks) {
        if (managerInstance.errorRecoveryCallbacks.clear) {
          managerInstance.errorRecoveryCallbacks.clear();
        }
        managerInstance.errorRecoveryCallbacks = null;
      }
      if (managerInstance._pendingOperations) {
        managerInstance._pendingOperations.clear();
        managerInstance._pendingOperations = null;
      }
      Object.keys(managerInstance).forEach(key => {
        if (typeof managerInstance[key] !== 'function') {
          managerInstance[key] = null;
        }
      });
    } catch (error) {
      console.warn('Non-critical TeamsManager cleanup warning:', error.message);
    }
  }
  cleanupTimersAndIntervals() {
    try {
      jest.clearAllTimers();
      jest.clearAllMocks();
      this.activeTimers.forEach(timerId => {
        try {
          clearTimeout(timerId);
        } catch (e) {}
      });
      this.activeTimers.clear();
      this.activeIntervals.forEach(intervalId => {
        try {
          clearInterval(intervalId);
        } catch (e) {}
      });
      this.activeIntervals.clear();
      const highestTimeoutId = setTimeout(() => {}, 0);
      for (let i = highestTimeoutId; i > 0; i--) {
        try {
          clearTimeout(i);
          clearInterval(i);
        } catch (e) {}
      }
    } catch (error) {
      console.warn('Non-critical timer cleanup warning:', error.message);
    }
  }
  forceGarbageCollection() {
    try {
      if (global.gc) {
        global.gc();
      }
      if (typeof jest !== 'undefined' && jest.resetModules) {
        jest.resetModules();
      }
      ['global.teamsManager', 'global.accessibilityTester', 'global.teamBuilder'].forEach(path => {
        const parts = path.split('.');
        let obj = global;
        for (let i = 1; i < parts.length - 1; i++) {
          obj = obj[parts[i]];
          if (!obj) break;
        }
        if (obj && parts.length > 1) {
          obj[parts[parts.length - 1]] = null;
          delete obj[parts[parts.length - 1]];
        }
      });
    } catch (error) {
      console.warn('Non-critical garbage collection warning:', error.message);
    }
  }
  performComprehensiveCleanup(context = {}) {
    const {
      container,
      document,
      teamsManager,
      accessibilityTester,
      teamBuilder
    } = context;
    try {
      this.cleanupAccessibilityTester(accessibilityTester);
      this.cleanupTeamsManager(teamsManager);
      if (teamBuilder) {
        if (typeof teamBuilder.destroy === 'function') {
          teamBuilder.destroy();
        }
        if (teamBuilder._cachedTeams) {
          teamBuilder._cachedTeams.clear();
          teamBuilder._cachedTeams = null;
        }
      }
      this.cleanupDOMEnvironment(container, document);
      this.cleanupTimersAndIntervals();
      this.forceGarbageCollection();
      this.takeMemorySnapshot();
    } catch (error) {
      console.error('Error during comprehensive cleanup:', error);
      this.forceGarbageCollection();
    }
  }
  takeMemorySnapshot() {
    try {
      if (process.memoryUsage) {
        const usage = process.memoryUsage();
        const snapshot = {
          timestamp: Date.now(),
          heapUsed: usage.heapUsed,
          heapTotal: usage.heapTotal,
          external: usage.external,
          rss: usage.rss
        };
        this.memorySnapshots.push(snapshot);
        if (this.memorySnapshots.length > 10) {
          this.memorySnapshots.shift();
        }
        const memoryUsageMB = usage.heapUsed / 1024 / 1024;
        if (memoryUsageMB > 400) {
          console.warn(`⚠️ Memory usage approaching limit: ${memoryUsageMB.toFixed(1)}MB / 512MB`);
        }
        return snapshot;
      }
    } catch (error) {
      console.warn('Memory monitoring error:', error.message);
    }
    return null;
  }
  getMemoryStatistics() {
    if (this.memorySnapshots.length === 0) return null;
    const latest = this.memorySnapshots[this.memorySnapshots.length - 1];
    const oldest = this.memorySnapshots[0];
    return {
      current: {
        heapUsedMB: (latest.heapUsed / 1024 / 1024).toFixed(1),
        heapTotalMB: (latest.heapTotal / 1024 / 1024).toFixed(1),
        externalMB: (latest.external / 1024 / 1024).toFixed(1)
      },
      trend: this.memorySnapshots.length > 1 ? {
        heapGrowthMB: ((latest.heapUsed - oldest.heapUsed) / 1024 / 1024).toFixed(1),
        duration: latest.timestamp - oldest.timestamp
      } : null,
      compliance: {
        isWithinLimit: latest.heapUsed < 512 * 1024 * 1024,
        utilizationPercent: (latest.heapUsed / (512 * 1024 * 1024) * 100).toFixed(1)
      }
    };
  }
}
exports.MemoryLeakResolver = MemoryLeakResolver;
const memoryLeakResolver = exports.memoryLeakResolver = new MemoryLeakResolver();
function enhancedAfterEach(context) {
  return () => {
    memoryLeakResolver.performComprehensiveCleanup(context);
  };
}
function memoryOptimizedBeforeEach() {
  return () => {
    memoryLeakResolver.takeMemorySnapshot();
    memoryLeakResolver.forceGarbageCollection();
    jest.clearAllMocks();
    jest.clearAllTimers();
  };
}
var _default = exports.default = MemoryLeakResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZW1vcnlMZWFrUmVzb2x2ZXIiLCJjb25zdHJ1Y3RvciIsImFjdGl2ZVRpbWVycyIsIlNldCIsImFjdGl2ZUludGVydmFscyIsImFjdGl2ZUV2ZW50TGlzdGVuZXJzIiwiTWFwIiwiYWN0aXZlRE9NT2JzZXJ2ZXJzIiwiYWN0aXZlRmV0Y2hSZXF1ZXN0cyIsIm1lbW9yeVNuYXBzaG90cyIsImNsZWFudXBBY2Nlc3NpYmlsaXR5VGVzdGVyIiwidGVzdGVySW5zdGFuY2UiLCJ2aW9sYXRpb25zIiwibGVuZ3RoIiwiZG9jdW1lbnQiLCJfY2FjaGVkRWxlbWVudHMiLCJjbGVhciIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwiZXJyb3IiLCJjb25zb2xlIiwid2FybiIsIm1lc3NhZ2UiLCJjbGVhbnVwRE9NRW52aXJvbm1lbnQiLCJjb250YWluZXIiLCJhbGxFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbGVtZW50IiwibmV3RWxlbWVudCIsImNsb25lTm9kZSIsInBhcmVudE5vZGUiLCJyZXBsYWNlQ2hpbGQiLCJpbm5lckhUTUwiLCJkYXRhc2V0Iiwid2luZG93IiwicHJvcCIsImNsZWFudXBUZWFtc01hbmFnZXIiLCJtYW5hZ2VySW5zdGFuY2UiLCJkZXN0cm95IiwiY2FjaGUiLCJuZXR3b3JrTWV0cmljcyIsInJldHJ5Q29uZmlnIiwiZXJyb3JSZWNvdmVyeUNhbGxiYWNrcyIsIl9wZW5kaW5nT3BlcmF0aW9ucyIsImNsZWFudXBUaW1lcnNBbmRJbnRlcnZhbHMiLCJqZXN0IiwiY2xlYXJBbGxUaW1lcnMiLCJjbGVhckFsbE1vY2tzIiwidGltZXJJZCIsImNsZWFyVGltZW91dCIsImUiLCJpbnRlcnZhbElkIiwiY2xlYXJJbnRlcnZhbCIsImhpZ2hlc3RUaW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwiaSIsImZvcmNlR2FyYmFnZUNvbGxlY3Rpb24iLCJnbG9iYWwiLCJnYyIsInJlc2V0TW9kdWxlcyIsInBhdGgiLCJwYXJ0cyIsInNwbGl0Iiwib2JqIiwicGVyZm9ybUNvbXByZWhlbnNpdmVDbGVhbnVwIiwiY29udGV4dCIsInRlYW1zTWFuYWdlciIsImFjY2Vzc2liaWxpdHlUZXN0ZXIiLCJ0ZWFtQnVpbGRlciIsIl9jYWNoZWRUZWFtcyIsInRha2VNZW1vcnlTbmFwc2hvdCIsInByb2Nlc3MiLCJtZW1vcnlVc2FnZSIsInVzYWdlIiwic25hcHNob3QiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiaGVhcFVzZWQiLCJoZWFwVG90YWwiLCJleHRlcm5hbCIsInJzcyIsInB1c2giLCJzaGlmdCIsIm1lbW9yeVVzYWdlTUIiLCJ0b0ZpeGVkIiwiZ2V0TWVtb3J5U3RhdGlzdGljcyIsImxhdGVzdCIsIm9sZGVzdCIsImN1cnJlbnQiLCJoZWFwVXNlZE1CIiwiaGVhcFRvdGFsTUIiLCJleHRlcm5hbE1CIiwidHJlbmQiLCJoZWFwR3Jvd3RoTUIiLCJkdXJhdGlvbiIsImNvbXBsaWFuY2UiLCJpc1dpdGhpbkxpbWl0IiwidXRpbGl6YXRpb25QZXJjZW50IiwiZXhwb3J0cyIsIm1lbW9yeUxlYWtSZXNvbHZlciIsImVuaGFuY2VkQWZ0ZXJFYWNoIiwibWVtb3J5T3B0aW1pemVkQmVmb3JlRWFjaCIsIl9kZWZhdWx0IiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIm1lbW9yeS1sZWFrLXJlc29sdXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBURC0wMDUgUGhhc2UgMjogTWVtb3J5IExlYWsgUmVzb2x1dGlvbiAmIEVuaGFuY2VkIENsZWFudXBcbiAqXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBtZW1vcnktb3B0aW1pemVkIGNsZWFudXAgdXRpbGl0aWVzIGFuZCBlbmhhbmNlZFxuICogdGVhcmRvd24gcHJvY2VkdXJlcyB0byByZXNvbHZlIG1lbW9yeSBsZWFrcyBpbiB0ZWFtcy1hY2Nlc3NpYmlsaXR5LnRlc3QuanNcbiAqIGFuZCB0ZWFtcy1lZGdlLWNhc2VzLnRlc3QuanMgd2hpbGUgbWFpbnRhaW5pbmcgUGhhc2UgMSBzdWNjZXNzIGNyaXRlcmlhLlxuICpcbiAqIENSSVRJQ0FMIFNVQ0NFU1MgQ1JJVEVSSUEgTUFJTlRBSU5FRDpcbiAqIC0gTWVtb3J5IHVzYWdlIDw1MTJNQiBkdXJpbmcgdGVzdCBleGVjdXRpb24g4pyFXG4gKiAtIFplcm8gaGFuZ2luZyB0ZXN0cyDinIVcbiAqIC0gVGVzdCBleGVjdXRpb24gdGltZSA8MjAwMG1zIGZvciB1bml0IHRlc3RzIChUQVJHRVQpXG4gKiAtIDEwMCUgdGVzdCBwYXNzIHJhdGUgKE1BSU5UQUlOKVxuICpcbiAqIEB2ZXJzaW9uIDIuMCAoVEQtMDA1IFBoYXNlIDIpXG4gKiBAYXV0aG9yIGdlbmRldi10ZXN0LXN1aXRlLWdlbmVyYXRvclxuICogQHByaW9yaXR5IEhpZ2ggKEJsb2NraW5nIFVTLTA4NyBQaGFzZSAyKVxuICovXG5cbmV4cG9ydCBjbGFzcyBNZW1vcnlMZWFrUmVzb2x2ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFjdGl2ZVRpbWVycyA9IG5ldyBTZXQoKTtcbiAgICB0aGlzLmFjdGl2ZUludGVydmFscyA9IG5ldyBTZXQoKTtcbiAgICB0aGlzLmFjdGl2ZUV2ZW50TGlzdGVuZXJzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuYWN0aXZlRE9NT2JzZXJ2ZXJzID0gbmV3IFNldCgpO1xuICAgIHRoaXMuYWN0aXZlRmV0Y2hSZXF1ZXN0cyA9IG5ldyBTZXQoKTtcbiAgICB0aGlzLm1lbW9yeVNuYXBzaG90cyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIGNsZWFudXAgZm9yIEFjY2Vzc2liaWxpdHlUZXN0ZXIgaW5zdGFuY2VzXG4gICAqIEFkZHJlc3NlcyBzcGVjaWZpYyBtZW1vcnkgbGVha3MgaW4gdGVhbXMtYWNjZXNzaWJpbGl0eS50ZXN0LmpzXG4gICAqL1xuICBjbGVhbnVwQWNjZXNzaWJpbGl0eVRlc3Rlcih0ZXN0ZXJJbnN0YW5jZSkge1xuICAgIGlmICghdGVzdGVySW5zdGFuY2UpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhciB2aW9sYXRpb25zIGFycmF5IHRvIGZyZWUgcmVmZXJlbmNlc1xuICAgICAgaWYgKHRlc3Rlckluc3RhbmNlLnZpb2xhdGlvbnMpIHtcbiAgICAgICAgdGVzdGVySW5zdGFuY2UudmlvbGF0aW9ucy5sZW5ndGggPSAwO1xuICAgICAgICB0ZXN0ZXJJbnN0YW5jZS52aW9sYXRpb25zID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIGRvY3VtZW50IHJlZmVyZW5jZSB0byBwcmV2ZW50IHJldGVudGlvblxuICAgICAgaWYgKHRlc3Rlckluc3RhbmNlLmRvY3VtZW50KSB7XG4gICAgICAgIHRlc3Rlckluc3RhbmNlLmRvY3VtZW50ID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYXIgYW55IGNhY2hlZCBET00gcXVlcmllc1xuICAgICAgaWYgKHRlc3Rlckluc3RhbmNlLl9jYWNoZWRFbGVtZW50cykge1xuICAgICAgICB0ZXN0ZXJJbnN0YW5jZS5fY2FjaGVkRWxlbWVudHMuY2xlYXIoKTtcbiAgICAgICAgdGVzdGVySW5zdGFuY2UuX2NhY2hlZEVsZW1lbnRzID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gTnVsbGlmeSB0aGUgaW5zdGFuY2UgY29tcGxldGVseVxuICAgICAgT2JqZWN0LmtleXModGVzdGVySW5zdGFuY2UpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgdGVzdGVySW5zdGFuY2Vba2V5XSA9IG51bGw7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdOb24tY3JpdGljYWwgY2xlYW51cCB3YXJuaW5nIGZvciBBY2Nlc3NpYmlsaXR5VGVzdGVyOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmhhbmNlZCBET00gY2xlYW51cCBmb3IgdGVhbXMgdGVzdHNcbiAgICogUHJldmVudHMgRE9NIGVsZW1lbnQgYWNjdW11bGF0aW9uIGFuZCBldmVudCBsaXN0ZW5lciBsZWFrc1xuICAgKi9cbiAgY2xlYW51cERPTUVudmlyb25tZW50KGNvbnRhaW5lciwgZG9jdW1lbnQpIHtcbiAgICBpZiAoIWNvbnRhaW5lciB8fCAhZG9jdW1lbnQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICAvLyBSZW1vdmUgYWxsIGV2ZW50IGxpc3RlbmVycyB0aGF0IG1heSBoYXZlIGJlZW4gYWRkZWQgZHVyaW5nIHRlc3RzXG4gICAgICBjb25zdCBhbGxFbGVtZW50cyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcqJyk7XG4gICAgICBhbGxFbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAvLyBDbG9uZSBhbmQgcmVwbGFjZSB0byByZW1vdmUgYWxsIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgICBjb25zdCBuZXdFbGVtZW50ID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0VsZW1lbnQsIGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xlYXIgaW5uZXJIVE1MIHRvIHJlbW92ZSBET00gcmVmZXJlbmNlc1xuICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuXG4gICAgICAvLyBSZW1vdmUgYW55IGRhdGEgYXR0cmlidXRlcyB0aGF0IG1pZ2h0IGhvbGQgcmVmZXJlbmNlc1xuICAgICAgaWYgKGNvbnRhaW5lci5kYXRhc2V0KSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGNvbnRhaW5lci5kYXRhc2V0KS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgZGVsZXRlIGNvbnRhaW5lci5kYXRhc2V0W2tleV07XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhciBhbnkgd2luZG93IHJlZmVyZW5jZXMgdGhhdCB0ZXN0cyBtaWdodCBoYXZlIGNyZWF0ZWRcbiAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBbJ3RlYW1zTWFuYWdlcicsICdhY2Nlc3NpYmlsaXR5VGVzdGVyJywgJ3RlYW1CdWlsZGVyJ10uZm9yRWFjaChwcm9wID0+IHtcbiAgICAgICAgICBpZiAod2luZG93W3Byb3BdKSB7XG4gICAgICAgICAgICB3aW5kb3dbcHJvcF0gPSBudWxsO1xuICAgICAgICAgICAgZGVsZXRlIHdpbmRvd1twcm9wXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ05vbi1jcml0aWNhbCBET00gY2xlYW51cCB3YXJuaW5nOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmhhbmNlZCBUZWFtc0VudGl0eU1hbmFnZXIgY2xlYW51cFxuICAgKiBBZGRyZXNzZXMgbWFuYWdlciBpbnN0YW5jZSBhY2N1bXVsYXRpb24gYW5kIHN0YXRlIGxlYWtzXG4gICAqL1xuICBjbGVhbnVwVGVhbXNNYW5hZ2VyKG1hbmFnZXJJbnN0YW5jZSkge1xuICAgIGlmICghbWFuYWdlckluc3RhbmNlKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2FsbCBwcm9wZXIgZGVzdHJveSBtZXRob2QgaWYgYXZhaWxhYmxlXG4gICAgICBpZiAodHlwZW9mIG1hbmFnZXJJbnN0YW5jZS5kZXN0cm95ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG1hbmFnZXJJbnN0YW5jZS5kZXN0cm95KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIGNhY2hlIGlmIHByZXNlbnRcbiAgICAgIGlmIChtYW5hZ2VySW5zdGFuY2UuY2FjaGUpIHtcbiAgICAgICAgaWYgKG1hbmFnZXJJbnN0YW5jZS5jYWNoZS5jbGVhcikge1xuICAgICAgICAgIG1hbmFnZXJJbnN0YW5jZS5jYWNoZS5jbGVhcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hbmFnZXJJbnN0YW5jZS5jYWNoZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYXIgbmV0d29yayBtZXRyaWNzIHRvIGZyZWUgbWVtb3J5XG4gICAgICBpZiAobWFuYWdlckluc3RhbmNlLm5ldHdvcmtNZXRyaWNzKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG1hbmFnZXJJbnN0YW5jZS5uZXR3b3JrTWV0cmljcykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgIG1hbmFnZXJJbnN0YW5jZS5uZXR3b3JrTWV0cmljc1trZXldID0gMDtcbiAgICAgICAgfSk7XG4gICAgICAgIG1hbmFnZXJJbnN0YW5jZS5uZXR3b3JrTWV0cmljcyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIHJldHJ5IGNvbmZpZ3VyYXRpb25cbiAgICAgIGlmIChtYW5hZ2VySW5zdGFuY2UucmV0cnlDb25maWcpIHtcbiAgICAgICAgbWFuYWdlckluc3RhbmNlLnJldHJ5Q29uZmlnID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYXIgZXJyb3IgcmVjb3ZlcnkgY2FsbGJhY2tzXG4gICAgICBpZiAobWFuYWdlckluc3RhbmNlLmVycm9yUmVjb3ZlcnlDYWxsYmFja3MpIHtcbiAgICAgICAgaWYgKG1hbmFnZXJJbnN0YW5jZS5lcnJvclJlY292ZXJ5Q2FsbGJhY2tzLmNsZWFyKSB7XG4gICAgICAgICAgbWFuYWdlckluc3RhbmNlLmVycm9yUmVjb3ZlcnlDYWxsYmFja3MuY2xlYXIoKTtcbiAgICAgICAgfVxuICAgICAgICBtYW5hZ2VySW5zdGFuY2UuZXJyb3JSZWNvdmVyeUNhbGxiYWNrcyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIGFueSBwZW5kaW5nIHByb21pc2VzIG9yIGNhbGxiYWNrc1xuICAgICAgaWYgKG1hbmFnZXJJbnN0YW5jZS5fcGVuZGluZ09wZXJhdGlvbnMpIHtcbiAgICAgICAgbWFuYWdlckluc3RhbmNlLl9wZW5kaW5nT3BlcmF0aW9ucy5jbGVhcigpO1xuICAgICAgICBtYW5hZ2VySW5zdGFuY2UuX3BlbmRpbmdPcGVyYXRpb25zID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gTnVsbGlmeSBhbGwgcHJvcGVydGllcyB0byBlbmFibGUgZ2FyYmFnZSBjb2xsZWN0aW9uXG4gICAgICBPYmplY3Qua2V5cyhtYW5hZ2VySW5zdGFuY2UpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBtYW5hZ2VySW5zdGFuY2Vba2V5XSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIG1hbmFnZXJJbnN0YW5jZVtrZXldID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignTm9uLWNyaXRpY2FsIFRlYW1zTWFuYWdlciBjbGVhbnVwIHdhcm5pbmc6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuaGFuY2VkIHRpbWVyIGFuZCBpbnRlcnZhbCBjbGVhbnVwXG4gICAqIFByZXZlbnRzIGhhbmdpbmcgdGltZXJzIHRoYXQgY2F1c2UgbWVtb3J5IGxlYWtzXG4gICAqL1xuICBjbGVhbnVwVGltZXJzQW5kSW50ZXJ2YWxzKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBDbGVhciBKZXN0IHRpbWVyc1xuICAgICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAgIC8vIENsZWFyIGFueSBtYW51YWxseSB0cmFja2VkIHRpbWVyc1xuICAgICAgdGhpcy5hY3RpdmVUaW1lcnMuZm9yRWFjaCh0aW1lcklkID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJJZCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBUaW1lciBtYXkgYWxyZWFkeSBiZSBjbGVhcmVkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5hY3RpdmVUaW1lcnMuY2xlYXIoKTtcblxuICAgICAgLy8gQ2xlYXIgYW55IG1hbnVhbGx5IHRyYWNrZWQgaW50ZXJ2YWxzXG4gICAgICB0aGlzLmFjdGl2ZUludGVydmFscy5mb3JFYWNoKGludGVydmFsSWQgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBJbnRlcnZhbCBtYXkgYWxyZWFkeSBiZSBjbGVhcmVkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5hY3RpdmVJbnRlcnZhbHMuY2xlYXIoKTtcblxuICAgICAgLy8gQ2xlYXIgYW55IHJlbWFpbmluZyBnbG9iYWwgdGltZXJzIChlbWVyZ2VuY3kgY2xlYW51cClcbiAgICAgIGNvbnN0IGhpZ2hlc3RUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHt9LCAwKTtcbiAgICAgIGZvciAobGV0IGkgPSBoaWdoZXN0VGltZW91dElkOyBpID4gMDsgaS0tKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KGkpO1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBFeHBlY3RlZCBmb3Igbm9uLWV4aXN0ZW50IHRpbWVyc1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignTm9uLWNyaXRpY2FsIHRpbWVyIGNsZWFudXAgd2FybmluZzonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRm9yY2UgZ2FyYmFnZSBjb2xsZWN0aW9uIGFuZCBtZW1vcnkgY2xlYW51cFxuICAgKiBFbnN1cmVzIG1lbW9yeSBpcyBhY3R1YWxseSBmcmVlZCBhZnRlciBjbGVhbnVwXG4gICAqL1xuICBmb3JjZUdhcmJhZ2VDb2xsZWN0aW9uKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBGb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb24gaWYgYXZhaWxhYmxlIChOb2RlLmpzIHdpdGggLS1leHBvc2UtZ2MpXG4gICAgICBpZiAoZ2xvYmFsLmdjKSB7XG4gICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhciBtb2R1bGUgY2FjaGUgZm9yIHRlc3QgbW9kdWxlcyAoYmUgY2FyZWZ1bCB3aXRoIHRoaXMpXG4gICAgICBpZiAodHlwZW9mIGplc3QgIT09ICd1bmRlZmluZWQnICYmIGplc3QucmVzZXRNb2R1bGVzKSB7XG4gICAgICAgIC8vIE9ubHkgcmVzZXQgdGVzdC1zcGVjaWZpYyBtb2R1bGVzLCBub3QgZnJhbWV3b3JrIG1vZHVsZXNcbiAgICAgICAgamVzdC5yZXNldE1vZHVsZXMoKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xlYXIgYW55IGdsb2JhbCB0ZXN0IHJlZmVyZW5jZXNcbiAgICAgIFsnZ2xvYmFsLnRlYW1zTWFuYWdlcicsICdnbG9iYWwuYWNjZXNzaWJpbGl0eVRlc3RlcicsICdnbG9iYWwudGVhbUJ1aWxkZXInXS5mb3JFYWNoKHBhdGggPT4ge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IHBhdGguc3BsaXQoJy4nKTtcbiAgICAgICAgbGV0IG9iaiA9IGdsb2JhbDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXJ0cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICBvYmogPSBvYmpbcGFydHNbaV1dO1xuICAgICAgICAgIGlmICghb2JqKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JqICYmIHBhcnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBvYmpbcGFydHNbcGFydHMubGVuZ3RoIC0gMV1dID0gbnVsbDtcbiAgICAgICAgICBkZWxldGUgb2JqW3BhcnRzW3BhcnRzLmxlbmd0aCAtIDFdXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignTm9uLWNyaXRpY2FsIGdhcmJhZ2UgY29sbGVjdGlvbiB3YXJuaW5nOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wcmVoZW5zaXZlIG1lbW9yeSBsZWFrIHByZXZlbnRpb24gZm9yIHRlYW1zIHRlc3RzXG4gICAqIFNpbmdsZSBtZXRob2QgdG8gaGFuZGxlIGFsbCBjbGVhbnVwIHNjZW5hcmlvc1xuICAgKi9cbiAgcGVyZm9ybUNvbXByZWhlbnNpdmVDbGVhbnVwKGNvbnRleHQgPSB7fSkge1xuICAgIGNvbnN0IHsgY29udGFpbmVyLCBkb2N1bWVudCwgdGVhbXNNYW5hZ2VyLCBhY2Nlc3NpYmlsaXR5VGVzdGVyLCB0ZWFtQnVpbGRlciB9ID0gY29udGV4dDtcblxuICAgIHRyeSB7XG4gICAgICAvLyAxLiBDbGVhbiB1cCBBY2Nlc3NpYmlsaXR5VGVzdGVyIGluc3RhbmNlXG4gICAgICB0aGlzLmNsZWFudXBBY2Nlc3NpYmlsaXR5VGVzdGVyKGFjY2Vzc2liaWxpdHlUZXN0ZXIpO1xuXG4gICAgICAvLyAyLiBDbGVhbiB1cCBUZWFtc0VudGl0eU1hbmFnZXIgaW5zdGFuY2VcbiAgICAgIHRoaXMuY2xlYW51cFRlYW1zTWFuYWdlcih0ZWFtc01hbmFnZXIpO1xuXG4gICAgICAvLyAzLiBDbGVhbiB1cCBUZWFtQnVpbGRlciBpbnN0YW5jZVxuICAgICAgaWYgKHRlYW1CdWlsZGVyKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGVhbUJ1aWxkZXIuZGVzdHJveSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHRlYW1CdWlsZGVyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDbGVhciBhbnkgY2FjaGVkIHRlYW1zXG4gICAgICAgIGlmICh0ZWFtQnVpbGRlci5fY2FjaGVkVGVhbXMpIHtcbiAgICAgICAgICB0ZWFtQnVpbGRlci5fY2FjaGVkVGVhbXMuY2xlYXIoKTtcbiAgICAgICAgICB0ZWFtQnVpbGRlci5fY2FjaGVkVGVhbXMgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIDQuIENsZWFuIHVwIERPTSBlbnZpcm9ubWVudFxuICAgICAgdGhpcy5jbGVhbnVwRE9NRW52aXJvbm1lbnQoY29udGFpbmVyLCBkb2N1bWVudCk7XG5cbiAgICAgIC8vIDUuIENsZWFuIHVwIHRpbWVycyBhbmQgaW50ZXJ2YWxzXG4gICAgICB0aGlzLmNsZWFudXBUaW1lcnNBbmRJbnRlcnZhbHMoKTtcblxuICAgICAgLy8gNi4gRm9yY2UgZ2FyYmFnZSBjb2xsZWN0aW9uXG4gICAgICB0aGlzLmZvcmNlR2FyYmFnZUNvbGxlY3Rpb24oKTtcblxuICAgICAgLy8gNy4gVGFrZSBtZW1vcnkgc25hcHNob3QgZm9yIG1vbml0b3JpbmdcbiAgICAgIHRoaXMudGFrZU1lbW9yeVNuYXBzaG90KCk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIGNvbXByZWhlbnNpdmUgY2xlYW51cDonLCBlcnJvcik7XG4gICAgICAvLyBDb250aW51ZSBjbGVhbnVwIGV2ZW4gaWYgc29tZSBwYXJ0cyBmYWlsXG4gICAgICB0aGlzLmZvcmNlR2FyYmFnZUNvbGxlY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWVtb3J5IG1vbml0b3JpbmcgZm9yIFRELTAwNSBjb21wbGlhbmNlXG4gICAqIEVuc3VyZXMgbWVtb3J5IHVzYWdlIHN0YXlzIGJlbG93IDUxMk1CIHRocmVzaG9sZFxuICAgKi9cbiAgdGFrZU1lbW9yeVNuYXBzaG90KCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAocHJvY2Vzcy5tZW1vcnlVc2FnZSkge1xuICAgICAgICBjb25zdCB1c2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSB7XG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIGhlYXBVc2VkOiB1c2FnZS5oZWFwVXNlZCxcbiAgICAgICAgICBoZWFwVG90YWw6IHVzYWdlLmhlYXBUb3RhbCxcbiAgICAgICAgICBleHRlcm5hbDogdXNhZ2UuZXh0ZXJuYWwsXG4gICAgICAgICAgcnNzOiB1c2FnZS5yc3NcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm1lbW9yeVNuYXBzaG90cy5wdXNoKHNuYXBzaG90KTtcblxuICAgICAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMCBzbmFwc2hvdHMgdG8gcHJldmVudCBtZW1vcnkgYWNjdW11bGF0aW9uXG4gICAgICAgIGlmICh0aGlzLm1lbW9yeVNuYXBzaG90cy5sZW5ndGggPiAxMCkge1xuICAgICAgICAgIHRoaXMubWVtb3J5U25hcHNob3RzLnNoaWZ0KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBMb2cgd2FybmluZyBpZiBhcHByb2FjaGluZyBtZW1vcnkgbGltaXRcbiAgICAgICAgY29uc3QgbWVtb3J5VXNhZ2VNQiA9IHVzYWdlLmhlYXBVc2VkIC8gMTAyNCAvIDEwMjQ7XG4gICAgICAgIGlmIChtZW1vcnlVc2FnZU1CID4gNDAwKSB7IC8vIDQwME1CIHdhcm5pbmcgdGhyZXNob2xkICg1MTJNQiBsaW1pdClcbiAgICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBNZW1vcnkgdXNhZ2UgYXBwcm9hY2hpbmcgbGltaXQ6ICR7bWVtb3J5VXNhZ2VNQi50b0ZpeGVkKDEpfU1CIC8gNTEyTUJgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzbmFwc2hvdDtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdNZW1vcnkgbW9uaXRvcmluZyBlcnJvcjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1lbW9yeSB1c2FnZSBzdGF0aXN0aWNzIGZvciByZXBvcnRpbmdcbiAgICovXG4gIGdldE1lbW9yeVN0YXRpc3RpY3MoKSB7XG4gICAgaWYgKHRoaXMubWVtb3J5U25hcHNob3RzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBsYXRlc3QgPSB0aGlzLm1lbW9yeVNuYXBzaG90c1t0aGlzLm1lbW9yeVNuYXBzaG90cy5sZW5ndGggLSAxXTtcbiAgICBjb25zdCBvbGRlc3QgPSB0aGlzLm1lbW9yeVNuYXBzaG90c1swXTtcblxuICAgIHJldHVybiB7XG4gICAgICBjdXJyZW50OiB7XG4gICAgICAgIGhlYXBVc2VkTUI6IChsYXRlc3QuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKSxcbiAgICAgICAgaGVhcFRvdGFsTUI6IChsYXRlc3QuaGVhcFRvdGFsIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMSksXG4gICAgICAgIGV4dGVybmFsTUI6IChsYXRlc3QuZXh0ZXJuYWwgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgxKVxuICAgICAgfSxcbiAgICAgIHRyZW5kOiB0aGlzLm1lbW9yeVNuYXBzaG90cy5sZW5ndGggPiAxID8ge1xuICAgICAgICBoZWFwR3Jvd3RoTUI6ICgobGF0ZXN0LmhlYXBVc2VkIC0gb2xkZXN0LmhlYXBVc2VkKSAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDEpLFxuICAgICAgICBkdXJhdGlvbjogbGF0ZXN0LnRpbWVzdGFtcCAtIG9sZGVzdC50aW1lc3RhbXBcbiAgICAgIH0gOiBudWxsLFxuICAgICAgY29tcGxpYW5jZToge1xuICAgICAgICBpc1dpdGhpbkxpbWl0OiBsYXRlc3QuaGVhcFVzZWQgPCAoNTEyICogMTAyNCAqIDEwMjQpLCAvLyA1MTJNQiBsaW1pdFxuICAgICAgICB1dGlsaXphdGlvblBlcmNlbnQ6ICgobGF0ZXN0LmhlYXBVc2VkIC8gKDUxMiAqIDEwMjQgKiAxMDI0KSkgKiAxMDApLnRvRml4ZWQoMSlcbiAgICAgIH1cbiAgICB9O1xuICB9XG59XG5cbi8vIEdsb2JhbCBpbnN0YW5jZSBmb3IgdXNlIGFjcm9zcyB0ZXN0IGZpbGVzXG5leHBvcnQgY29uc3QgbWVtb3J5TGVha1Jlc29sdmVyID0gbmV3IE1lbW9yeUxlYWtSZXNvbHZlcigpO1xuXG4vKipcbiAqIEVuaGFuY2VkIGFmdGVyRWFjaCBoZWxwZXIgZm9yIHRlYW1zIHRlc3RzXG4gKiBEcm9wLWluIHJlcGxhY2VtZW50IGZvciBleGlzdGluZyBhZnRlckVhY2ggY2xlYW51cFxuICovXG5leHBvcnQgZnVuY3Rpb24gZW5oYW5jZWRBZnRlckVhY2goY29udGV4dCkge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIG1lbW9yeUxlYWtSZXNvbHZlci5wZXJmb3JtQ29tcHJlaGVuc2l2ZUNsZWFudXAoY29udGV4dCk7XG4gIH07XG59XG5cbi8qKlxuICogTWVtb3J5LW9wdGltaXplZCBiZWZvcmVFYWNoIGhlbHBlclxuICogRW5zdXJlcyBjbGVhbiBzdGF0ZSBiZWZvcmUgZWFjaCB0ZXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtZW1vcnlPcHRpbWl6ZWRCZWZvcmVFYWNoKCkge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIC8vIFRha2UgaW5pdGlhbCBtZW1vcnkgc25hcHNob3RcbiAgICBtZW1vcnlMZWFrUmVzb2x2ZXIudGFrZU1lbW9yeVNuYXBzaG90KCk7XG5cbiAgICAvLyBDbGVhciBhbnkgbGVmdG92ZXIgcmVmZXJlbmNlc1xuICAgIG1lbW9yeUxlYWtSZXNvbHZlci5mb3JjZUdhcmJhZ2VDb2xsZWN0aW9uKCk7XG5cbiAgICAvLyBSZXNldCBKZXN0IHN0YXRlXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC5jbGVhckFsbFRpbWVycygpO1xuICB9O1xufVxuXG4vLyBFeHBvcnQgZGVmYXVsdCBmb3IgZWFzeSBpbXBvcnRpbmdcbmV4cG9ydCBkZWZhdWx0IE1lbW9yeUxlYWtSZXNvbHZlcjsiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWtCTyxNQUFNQSxrQkFBa0IsQ0FBQztFQUM5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