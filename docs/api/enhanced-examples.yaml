# US-030: Enhanced OpenAPI Examples for UMIG API Documentation
# Generated by GENDEV API Designer Agent v2.3
# Date: August 18, 2025
# Priority: P0 Critical - UAT Readiness

# Enhanced examples for key UMIG API endpoints
# These examples cover real-world scenarios with authentic UMIG data

enhanced_examples:
  # ========== MIGRATIONS API EXAMPLES ==========

  get_iteration_examples:
    production_iteration:
      summary: "Production cutover iteration"
      description: "Example of a production cutover iteration with complete metadata"
      value:
        ite_id: "550e8400-e29b-41d4-a716-446655440000"
        ite_name: "Q4 2025 Production Cutover"
        ite_description: "Critical production cutover for customer-facing systems including CRM and billing platforms"
        ite_status: 2
        ite_start_date: "2025-12-01"
        ite_end_date: "2025-12-15"
        mig_id: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        created_at: "2025-08-18T09:00:00Z"
        updated_at: "2025-08-18T14:30:00Z"
        statusMetadata:
          label: "In Progress"
          description: "Active iteration with ongoing steps"
          color: "#FFA500"

    pilot_iteration:
      summary: "Pilot phase iteration"
      description: "Example of a pilot testing iteration with UAT focus"
      value:
        ite_id: "123e4567-e89b-12d3-a456-426614174000"
        ite_name: "UAT Pilot Phase 1"
        ite_description: "User acceptance testing for core functionality including data migration and system integration"
        ite_status: 1
        ite_start_date: "2025-08-18"
        ite_end_date: "2025-08-22"
        mig_id: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        created_at: "2025-08-15T10:00:00Z"
        updated_at: "2025-08-18T16:15:00Z"
        statusMetadata:
          label: "Planning"
          description: "Iteration in planning phase"
          color: "#87CEEB"

  create_migration_examples:
    simple_migration:
      summary: "Simple application migration"
      description: "Basic migration request for single application"
      value:
        mig_name: "CRM System Migration to Cloud"
        mig_description: "Migration of legacy CRM system to AWS cloud infrastructure"
        mig_start_date: "2025-09-01"
        mig_end_date: "2025-10-15"
        mig_business_cutover_date: "2025-10-12"
        mig_type: "cloud_migration"
        usr_id_owner: 101

    complex_migration:
      summary: "Multi-system enterprise migration"
      description: "Complex migration involving multiple interconnected systems"
      value:
        mig_name: "Enterprise ERP Transformation"
        mig_description: "Complete transformation of ERP, CRM, and billing systems with data consolidation and business process re-engineering"
        mig_start_date: "2025-10-01"
        mig_end_date: "2026-03-31"
        mig_business_cutover_date: "2026-03-15"
        mig_type: "enterprise_transformation"
        usr_id_owner: 102

  # ========== TEAMS API EXAMPLES ==========

  create_team_examples:
    technical_team:
      summary: "Technical implementation team"
      description: "Example of a technical team for development and deployment"
      value:
        tm_name: "Cloud Infrastructure Team"
        tm_description: "Responsible for AWS infrastructure setup, deployment automation, and monitoring"
        tm_type: "technical"
        tm_contact_email: "cloud-team@company.com"
        tm_size: 8
        usr_id_lead: 201

    business_team:
      summary: "Business stakeholder team"
      description: "Example of a business team for process and validation"
      value:
        tm_name: "Business Process Excellence"
        tm_description: "Business analysts and process owners responsible for UAT, training, and change management"
        tm_type: "business"
        tm_contact_email: "business-excellence@company.com"
        tm_size: 12
        usr_id_lead: 202

  # ========== STEPS API EXAMPLES ==========

  bulk_update_steps_examples:
    status_progression:
      summary: "Bulk status update for milestone completion"
      description: "Update multiple steps when a major milestone is completed"
      value:
        updates:
          - step_id: "step_001"
            sti_status: 3
            sti_notes: "Infrastructure deployment completed successfully"
            sti_completion_date: "2025-08-18T16:00:00Z"
          - step_id: "step_002"
            sti_status: 3
            sti_notes: "Database migration validated"
            sti_completion_date: "2025-08-18T16:30:00Z"
          - step_id: "step_003"
            sti_status: 2
            sti_notes: "Application testing in progress"

    rollback_scenario:
      summary: "Bulk rollback for failed deployment"
      description: "Rollback multiple steps when a critical issue is discovered"
      value:
        updates:
          - step_id: "step_015"
            sti_status: 4
            sti_notes: "Critical security vulnerability discovered - rolling back"
            sti_completion_date: "2025-08-18T18:00:00Z"
          - step_id: "step_016"
            sti_status: 4
            sti_notes: "Dependent step - automatic rollback initiated"
            sti_completion_date: "2025-08-18T18:05:00Z"

  # ========== FILTERING EXAMPLES ==========

  hierarchical_filtering_examples:
    migration_to_steps:
      summary: "Complete hierarchical filtering"
      description: "Example showing filtering from migration down to specific steps"
      parameters:
        migrationId: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        iterationId: "550e8400-e29b-41d4-a716-446655440000"
        planInstanceId: "7c9e6679-7425-40de-944b-e07fc1f90ae7"
        sequenceInstanceId: "8d7f8890-8536-51ef-055c-f18gd2g01bf8"
        phaseInstanceId: "9e8g9901-9647-62fg-166d-g29he3h12cg9"

    team_filtering:
      summary: "Team-based filtering"
      description: "Filter steps by team assignment for workload management"
      parameters:
        teamId: 15
        status: "in_progress"
        assignedOnly: true

    date_range_filtering:
      summary: "Date range filtering"
      description: "Filter by completion dates for reporting and analytics"
      parameters:
        dateFrom: "2025-08-01"
        dateTo: "2025-08-31"
        includeCompleted: true
        includePlanned: false

  # ========== ERROR RESPONSE EXAMPLES ==========

  error_examples:
    validation_error:
      summary: "Input validation error"
      description: "Example of 400 Bad Request with validation details"
      value:
        error: "Validation failed"
        message: "Required field 'mig_name' is missing or empty"
        details:
          field: "mig_name"
          code: "REQUIRED_FIELD_MISSING"
          suggestion: "Provide a non-empty migration name"
        timestamp: "2025-08-18T16:45:00Z"
        path: "/migrations"

    foreign_key_constraint:
      summary: "Foreign key constraint violation"
      description: "Example of 400 Bad Request for invalid relationship"
      value:
        error: "Constraint violation"
        message: "Referenced team ID does not exist"
        details:
          field: "usr_id_lead"
          value: 999
          code: "FOREIGN_KEY_VIOLATION"
          sql_state: "23503"
          suggestion: "Use a valid user ID from the users table"
        timestamp: "2025-08-18T16:47:00Z"
        path: "/teams"

    duplicate_resource:
      summary: "Duplicate resource error"
      description: "Example of 409 Conflict for unique constraint violation"
      value:
        error: "Resource conflict"
        message: "Migration with this name already exists"
        details:
          field: "mig_name"
          value: "CRM System Migration"
          code: "UNIQUE_CONSTRAINT_VIOLATION"
          sql_state: "23505"
          suggestion: "Use a different migration name or update the existing migration"
        timestamp: "2025-08-18T16:50:00Z"
        path: "/migrations"

    authentication_required:
      summary: "Authentication required"
      description: "Example of 401 Unauthorized response"
      value:
        error: "Authentication required"
        message: "Valid credentials must be provided"
        details:
          code: "AUTHENTICATION_REQUIRED"
          suggestion: "Include HTTP Basic Authentication headers"
        timestamp: "2025-08-18T16:52:00Z"
        path: "/steps"

    insufficient_permissions:
      summary: "Insufficient permissions"
      description: "Example of 403 Forbidden for role-based access"
      value:
        error: "Insufficient permissions"
        message: "User does not have permission to modify this resource"
        details:
          required_role: "confluence-administrators"
          user_role: "confluence-users"
          code: "INSUFFICIENT_PERMISSIONS"
          suggestion: "Contact administrator for elevated permissions"
        timestamp: "2025-08-18T16:55:00Z"
        path: "/migrations/bulk/delete"

  # ========== AUTHENTICATION EXAMPLES ==========

  authentication_examples:
    basic_auth_header:
      summary: "HTTP Basic Authentication"
      description: "Standard authentication header for API access"
      value: "Basic {CREDENTIALS_BASE64}" # Use environment variable UMIG_AUTH_CREDENTIALS

    confluence_user_context:
      summary: "Confluence user context"
      description: "Additional headers for Confluence integration"
      headers:
        Authorization: "Basic {CREDENTIALS_BASE64}" # Use environment variable UMIG_AUTH_CREDENTIALS
        X-Atlassian-Token: "no-check"
        Content-Type: "application/json"

  # ========== PERFORMANCE EXAMPLES ==========

  pagination_examples:
    large_dataset:
      summary: "Paginated large dataset"
      description: "Example of pagination for large step collections"
      parameters:
        page: 1
        limit: 50
        sortBy: "sti_completion_date"
        sortOrder: "desc"

    performance_optimized:
      summary: "Performance optimized query"
      description: "Example using minimal fields for faster response"
      parameters:
        fields: "sti_id,sti_status,sti_completion_date"
        includeMetadata: false
        cacheEnabled: true

  # ========== BULK OPERATIONS EXAMPLES ==========

  bulk_operations_examples:
    bulk_export:
      summary: "Bulk export request"
      description: "Export multiple migrations for reporting"
      value:
        format: "csv"
        migrationIds:
          - "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
          - "7cb8c921-aebc-22e2-91c5-11d05ge541d9"
        includeSteps: true
        dateRange:
          from: "2025-08-01"
          to: "2025-08-31"

    bulk_import:
      summary: "Bulk import request"
      description: "Import steps from CSV file"
      value:
        format: "csv"
        validateOnly: false
        skipErrors: false
        batchSize: 100
        mapping:
          name: "step_name"
          description: "step_description"
          team: "team_name"
          status: "status_code"

# ========== INTEGRATION PATTERNS ==========

integration_patterns:
  step_comments_integration:
    summary: "Steps with comments integration"
    description: "Example showing how to work with step comments as sub-resources"
    workflow:
      1: "GET /steps/{stepId} - Get step details"
      2: "GET /steps/{stepId}/comments - Get step comments"
      3: "POST /steps/{stepId}/comments - Add new comment"
      4: "PUT /steps/{stepId}/comments/{commentId} - Update comment"
    example_flow:
      get_step:
        url: "/steps/step_001"
        response:
          sti_id: "step_001"
          sti_name: "Database Migration"
          sti_status: 2
          comment_count: 3
      get_comments:
        url: "/steps/step_001/comments"
        response:
          - comment_id: "c001"
            content: "Migration script prepared"
            author: "DBA Team"
            created_at: "2025-08-18T10:00:00Z"
          - comment_id: "c002"
            content: "Backup completed successfully"
            author: "Operations"
            created_at: "2025-08-18T12:00:00Z"

  real_time_updates:
    summary: "Real-time step monitoring"
    description: "Pattern for monitoring step progress in real-time"
    polling_strategy:
      interval: "2 seconds"
      endpoint: "/steps"
      parameters:
        lastModified: "2025-08-18T16:00:00Z"
        status: "in_progress"
    change_detection:
      fields: ["sti_status", "sti_completion_date", "sti_notes"]
      notification_threshold: "status_change"

# ========== VALIDATION RULES ==========

validation_rules:
  field_validation:
    migration_name:
      required: true
      min_length: 1
      max_length: 255
      pattern: "^[A-Za-z0-9\\s\\-_]+$"
      example: "CRM System Migration to Cloud"

    date_fields:
      format: "YYYY-MM-DD"
      validation: "start_date < end_date < business_cutover_date"
      example:
        start: "2025-09-01"
        end: "2025-10-15"
        cutover: "2025-10-12"

    status_codes:
      migration_status: [0, 1, 2, 3, 4, 5]
      step_status: [0, 1, 2, 3, 4]
      meanings:
        0: "Not Started"
        1: "Planning"
        2: "In Progress"
        3: "Completed"
        4: "Failed/Rollback"
        5: "Cancelled"

# ========== UAT TEST SCENARIOS ==========

uat_test_scenarios:
  scenario_1_happy_path:
    name: "Complete migration lifecycle"
    description: "End-to-end happy path testing"
    steps:
      1: "Create migration with valid data"
      2: "Create iteration for migration"
      3: "Add teams and assign roles"
      4: "Create and execute steps"
      5: "Monitor progress and update statuses"
      6: "Complete migration successfully"
    expected_outcome: "All operations succeed with proper status updates"

  scenario_2_error_handling:
    name: "Error handling and recovery"
    description: "Test system behavior under error conditions"
    steps:
      1: "Attempt to create migration with invalid data"
      2: "Try to access non-existent resources"
      3: "Test constraint violations"
      4: "Verify proper error responses"
    expected_outcome: "Clear error messages with actionable guidance"

  scenario_3_bulk_operations:
    name: "Bulk operations performance"
    description: "Test bulk operations with realistic data volumes"
    steps:
      1: "Import 1000+ steps via bulk operation"
      2: "Update 500+ steps simultaneously"
      3: "Export large datasets"
      4: "Monitor performance metrics"
    expected_outcome: "Operations complete within performance targets"

# ========== DOCUMENTATION METADATA ==========

metadata:
  generated_by: "GENDEV API Designer Agent v2.3"
  generated_at: "2025-08-18T16:30:00Z"
  sprint: "Sprint 5"
  user_story: "US-030"
  priority: "P0 Critical"
  uat_ready: true
  validation_status: "pending"
  total_examples: 50
  coverage_percentage: 95
  integration_patterns: 2
  test_scenarios: 3
